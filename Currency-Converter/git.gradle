def getPatchArray() {
    def diffOutput = new ByteArrayOutputStream()
    exec {
        commandLine 'git', 'describe'
        standardOutput = diffOutput
    }
    def res = diffOutput.toString()

    // delete added information about commits in the end of git tag message
    if (res.contains('-'))
        res = res.split('-')[0]

    if(res.count('.')==2){
        List posList = new ArrayList()
        def dot = res.indexOf('.')
        posList.add(res.substring(0,dot))
        res = res.substring(dot+1, res.length())
        dot = res.indexOf('.')
        posList.add(res.substring(0,dot))
        posList.add(res.substring(dot+1))
        return posList
    } else {
        return ["0","0","0"]
    }
}

static def generateVersionCode(ArrayList array) {
    def res = (array[0].toInteger()*10 + array[1].toInteger())*100 + array[2].toInteger()
    return res
}

ext {
    getPatchArray = this.&getPatchArray
    generateVersionCode = this.&generateVersionCode
}